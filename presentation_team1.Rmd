---
title: "Relation between Drinking and Smoking to Academic Performance"
author: "Yunran Chen, Brian Kundinger, Rihui Ou"
output:
  beamer_presentation: default
  slidy_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(tidy=FALSE, warning=FALSE, message=FALSE, cache=TRUE, 
               comment=NA, verbose=TRUE, fig.width=5, fig.height=3,echo=FALSE)

library(corrplot)
library(naniar)
library(ggplot2)
library(dplyr)
library(tibble)
library(tidyr)
library(purrr)
library(lme4)
library(ggpubr)
library(stringr)
library(ggmosaic)
library(MASS)
load("eda.rdata")
#save.image(file = "eda.rdata")
theme_set(theme_bw())
```


## Introduction

- Data: 2001 College Alcohol Study, 10904 observations respectively
- Goal: How do drinking and smoking affect academic performance?
- Challenges: 
  - latent construct of drinking behavior and smoking behavior cannot be directly measured by a single observed variable
  - -> latent factor based model
- Model: 
  - Structural Equation Model (SEM): studying interrelationships among observed and latent variables 
  - Build SEM for 2001 

## Pick variables 

- Academic (response variable): f5 (GPA)
- Drinking:
    - c7: current use of alcohol (abstainer/former drinker/...)
    - c11: on how many occasions have a drink (1-2/3-5/...)
    - c12: how many drinks in these occasions (0/1/2/...)
    - problem_drinking(c17): how often has your drinking caused you to ...
    - family drinking: g15,g16,g17
- Smooking:
    - e3: on how many days smoke
    - e4: how many cigarettes a day
    - e8: smoke with people/alone/...
    - e11-12: exposed to smoking
- Background:
    - fraternity/sorority: a5,a6,a8d
    - gender,race: a2,g3a-e

## EDA: Relation between drinking behavior and GPA

- The increasing proportion of higher GPA relate to less alcohol use
- Students with high GPA tend to "overestimate" the severity (vice versa for students with lower GPA)
- Students with low GPA tend to be heavy drinker and cause problems

```{r edadrinking}
dat_01 %>%
  dplyr::select(c7,c11,c12,problem_drinking,f5) %>% 
  mutate(f5=f5%>%
    factor(x = .,levels = 1:9,labels =  c("A","A-","B+","B","B-","C+","C","C-","D"))) %>%
  gather(data=.,key = key,value = value,-f5) %>% 
  ggplot(aes(x=value,fill=f5)) +
    facet_wrap(~ key, scales = "free") +
    geom_bar(position = "fill")
```


## EDA: Relation between smoking behavior and GPA

The increasing proportion of higher GPA relate to

- less exposed to smoking environment
- the degree of addiction decrease
- For the students smoke more than a pack per day, students with high GPA take a large proportion.

```{r eda smookinggpa2}
dat_01 %>%
  dplyr::select(e3,e4,e8,e11:e12,f5) %>% 
  mutate(f5=f5%>%
    factor(x = .,levels = 1:9,labels =  c("A","A-","B+","B","B-","C+","C","C-","D"))) %>%
  gather(data=.,key = key,value = value,-f5) %>% 
  ggplot(aes(x=value,fill=f5)) +
    facet_wrap(~ key, scales = "free") +
    geom_bar(position = "fill")
```

## EDA: Relation between drinking/smoking and background 

heavier use of alcohol/cigaret relate to 

- member of a fraternity/sorority
- live in fraternity/sorority 
- think fraternity/sorority life is important
- mother/father is problem drinker
- family accept heavy drinking

heavier use of alcohol relate to 

- male

## EDA: Relation between drinking/smoking and background 

```{r eda bkgdri,fig.width=6, fig.height=5}
dat_01 %>%
  dplyr::select(a2,a5,a6,a8d,g3,g15,g16,g17,c7) %>% 
  mutate(c7=case_when(
    c7==1 ~ "abstainer",
    c7==2 ~ "former",
    c7==3 ~ "infrequent",
    c7==4 ~ "light",
    c7==5 ~ "moderate",
    c7==6 ~ "heavy",
    c7==7 ~ "problem"
  )%>%factor(x = .,levels = c("abstainer","former","infrequent","light","moderate","heavy","problem")
           ))%>%
  gather(data=.,key = key,value = value,-c7) %>% 
  ggplot(aes(x=value,fill=c7)) +
    facet_wrap(~ key, scales = "free") +
    geom_bar(position = "fill")
```


```{r eda bkg, eval=FALSE, include=FALSE}
dat_01 %>%
  dplyr::select(a5,a6,a8d,g3,g6,g7,g8,g15,g16,e3) %>% 
  mutate(smoke=if_else(e3==1,"non-smoke","smoke")%>%as.factor())%>%
  dplyr::select(-e3,-g7,-g8)%>%
  gather(data=.,key = key,value = value,-smoke) %>% 
  ggplot(aes(x=value,fill=smoke)) +
    facet_wrap(~ key, scales = "free") +
    geom_bar(position = "fill")
```

## Data Preprocessing

- Impute the NA's based on the relation to other questions
- create indicator `a6i` presenting whether a student lives in fraternity/sorority house
- create problem_drinking counting how many times a student cause problems because of drinking
- Obtain the complete cases (keep 87.5%)

## Model

Add SEM formula here

## Model

```{r graph, echo=FALSE,  out.width = '70%', fig.align='center'}
knitr::include_graphics("graph.png")
```


## Results

```{r lvar, echo=FALSE,  out.width = '80%', fig.align='center'}
knitr::include_graphics("lvar.png")
```

## Results

```{r reg, echo=FALSE,  out.width = '80%', fig.align='center'}
knitr::include_graphics("reg.png")
```

## Interpretation 

Add here

## Discussion

- Data imputation
- Comparison between 1997 to 2001